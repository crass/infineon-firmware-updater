<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>TPMFactoryUpd: Source/Common/FirmwareUpdate.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="IFXStyleSheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table width="100%" cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo" style="vertical-align: middle"><img alt="Logo" src="infineon_large.png" style="padding: 5%;" /></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">TPMFactoryUpd
   &#160;<span id="projectnumber">01.01.2529.00</span>
   </div>
   <div id="projectbrief">A factory tool for updating the firmware of an Infineon Technologies TPM</div>
  </td>
  <td style="vertical-align:top; text-align: right; padding-right: 0.2em"><font color="#E20036"><b>Restricted</b></font></td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_74389ed8173ad57b461b9d623a1f3867.html">Source</a></li><li class="navelem"><a class="el" href="dir_573d75420a9527d403ae2af0f90fb3b6.html">Common</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">FirmwareUpdate.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implements common firmware update functionality used by different tools.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="_firmware_update_8h_source.html">FirmwareUpdate.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_firmware_image_8h_source.html">FirmwareImage.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_crypt_8h_source.html">Crypt.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___marshal_8h_source.html">TPM2_Marshal.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___flush_context_8h_source.html">TPM2_FlushContext.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___get_capability_8h_source.html">TPM2_GetCapability.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___get_test_result_8h_source.html">TPM2_GetTestResult.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___hierarchy_change_auth_8h_source.html">TPM2_HierarchyChangeAuth.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___policy_command_code_8h_source.html">TPM2_PolicyCommandCode.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___policy_secret_8h_source.html">TPM2_PolicySecret.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___set_primary_policy_8h_source.html">TPM2_SetPrimaryPolicy.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___start_auth_session_8h_source.html">TPM2_StartAuthSession.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___startup_8h_source.html">TPM2_Startup.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___field_upgrade_types_8h_source.html">TPM2_FieldUpgradeTypes.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___field_upgrade_marshal_8h_source.html">TPM2_FieldUpgradeMarshal.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m2___field_upgrade_start_vendor_8h_source.html">TPM2_FieldUpgradeStartVendor.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___types_8h_source.html">TPM_Types.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___startup_8h_source.html">TPM_Startup.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___get_capability_8h_source.html">TPM_GetCapability.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___get_test_result_8h_source.html">TPM_GetTestResult.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___owner_read_internal_pub_8h_source.html">TPM_OwnerReadInternalPub.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___flush_specific_8h_source.html">TPM_FlushSpecific.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___o_i_a_p_8h_source.html">TPM_OIAP.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___o_s_a_p_8h_source.html">TPM_OSAP.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___field_upgrade_info_request_8h_source.html">TPM_FieldUpgradeInfoRequest.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___field_upgrade_info_request2_8h_source.html">TPM_FieldUpgradeInfoRequest2.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___field_upgrade_start_8h_source.html">TPM_FieldUpgradeStart.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___field_upgrade_update_8h_source.html">TPM_FieldUpgradeUpdate.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_t_p_m___field_upgrade_complete_8h_source.html">TPM_FieldUpgradeComplete.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a83060c57ec90e738b71452e69b861eef"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#a83060c57ec90e738b71452e69b861eef">TPM_FU_COMPLETE_WAIT_TIME</a>&#160;&#160;&#160;2000</td></tr>
<tr class="memdesc:a83060c57ec90e738b71452e69b861eef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default wait time in milliseconds after sending TPM_FieldUpgrade_Complete before continuing to give TPM time to finish.  <a href="#a83060c57ec90e738b71452e69b861eef">More...</a><br /></td></tr>
<tr class="separator:a83060c57ec90e738b71452e69b861eef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe09c8981014e666d7bb530bc2860612"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#afe09c8981014e666d7bb530bc2860612">TPM_FU_START_MAX_RETRIES</a>&#160;&#160;&#160;16U</td></tr>
<tr class="memdesc:afe09c8981014e666d7bb530bc2860612"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum amount of times to check if TPM switched to boot loader mode after TPM_FieldUpgrade_Start command.  <a href="#afe09c8981014e666d7bb530bc2860612">More...</a><br /></td></tr>
<tr class="separator:afe09c8981014e666d7bb530bc2860612"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a060fa8ca52096abe6ac1351db2719709"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#a060fa8ca52096abe6ac1351db2719709">TPM_FU_START_RETRY_WAIT_TIME</a>&#160;&#160;&#160;1000</td></tr>
<tr class="memdesc:a060fa8ca52096abe6ac1351db2719709"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default wait time in milliseconds in between two of the above checks.  <a href="#a060fa8ca52096abe6ac1351db2719709">More...</a><br /></td></tr>
<tr class="separator:a060fa8ca52096abe6ac1351db2719709"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0377c76556033d78a1b3b1af60b6692a"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#a0377c76556033d78a1b3b1af60b6692a">FirmwareUpdate_CalculateState</a> (_Out_ <a class="el" href="struct_t_p_m___s_t_a_t_e.html">TPM_STATE</a> *PpsTpmState)</td></tr>
<tr class="memdesc:a0377c76556033d78a1b3b1af60b6692a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the TPM state attributes.  <a href="#a0377c76556033d78a1b3b1af60b6692a">More...</a><br /></td></tr>
<tr class="separator:a0377c76556033d78a1b3b1af60b6692a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a845ea7abd1bced9eb1c358bc2e954d8e"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#a845ea7abd1bced9eb1c358bc2e954d8e">FirmwareUpdate_CheckImage</a> (_In_bytecount_(PullImageSize) <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> *PrgbImage, _In_ <a class="el" href="_t_p_m2___types_8h.html#a95df6cdb32afc350ff070f2fe8a54a67">UINT64</a> PullImageSize, _Out_ <a class="el" href="_globals_8h.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> *PpfValid, _Out_ <a class="el" href="struct_b_i_t_f_i_e_l_d___n_e_w___t_p_m___f_i_r_m_w_a_r_e___i_n_f_o.html">BITFIELD_NEW_TPM_FIRMWARE_INFO</a> *PpbfNewTpmFirmwareInfo, _Out_ <a class="el" href="_t_p_m2___types_8h.html#adfe04a44baaebba6143c3a23507ff85b">UINT32</a> *PpunErrorDetails)</td></tr>
<tr class="memdesc:a845ea7abd1bced9eb1c358bc2e954d8e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the firmware image is valid for the TPM.  <a href="#a845ea7abd1bced9eb1c358bc2e954d8e">More...</a><br /></td></tr>
<tr class="separator:a845ea7abd1bced9eb1c358bc2e954d8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab87fa675eeff94b93fe70af6949ff7c2"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#ab87fa675eeff94b93fe70af6949ff7c2">FirmwareUpdate_CheckOwnerAuthorization</a> (_In_bytecount_(<a class="el" href="_t_p_m2___types_8h.html#a3ba9296b223f1b3c710d6b812fd860e8">SHA1_DIGEST_SIZE</a>) const <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> PrgbOwnerAuthHash[<a class="el" href="_t_p_m2___types_8h.html#a3ba9296b223f1b3c710d6b812fd860e8">SHA1_DIGEST_SIZE</a>])</td></tr>
<tr class="memdesc:ab87fa675eeff94b93fe70af6949ff7c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks TPM Owner authorization on TPM1.2.  <a href="#ab87fa675eeff94b93fe70af6949ff7c2">More...</a><br /></td></tr>
<tr class="separator:ab87fa675eeff94b93fe70af6949ff7c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5922ef9aed2a0504451573ec997ec076"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#a5922ef9aed2a0504451573ec997ec076">FirmwareUpdate_Complete</a> (_In_ <a class="el" href="_firmware_update_8h.html#abc0806f5fb50bb895b973508020604df">PFN_FIRMWAREUPDATE_PROGRESSCALLBACK</a> PfnProgress)</td></tr>
<tr class="memdesc:a5922ef9aed2a0504451573ec997ec076"><td class="mdescLeft">&#160;</td><td class="mdescRight">FirmwareUpdate Complete.  <a href="#a5922ef9aed2a0504451573ec997ec076">More...</a><br /></td></tr>
<tr class="separator:a5922ef9aed2a0504451573ec997ec076"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57734866cfa76a17da2cd78309267e00"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#a57734866cfa76a17da2cd78309267e00">FirmwareUpdate_GetImageInfo</a> (_Inout_bytecap_(*PpunVersionNameSize) wchar_t *PwszVersionName, _Inout_ unsigned int *PpunVersionNameSize, _Inout_ <a class="el" href="struct_t_p_m___s_t_a_t_e.html">TPM_STATE</a> *PpsTpmState, _Inout_ unsigned int *PpunRemainingUpdates)</td></tr>
<tr class="memdesc:a57734866cfa76a17da2cd78309267e00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns information about the current state of TPM.  <a href="#a57734866cfa76a17da2cd78309267e00">More...</a><br /></td></tr>
<tr class="separator:a57734866cfa76a17da2cd78309267e00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3cb3f9cefe034224b64ad96ee2d900e"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#af3cb3f9cefe034224b64ad96ee2d900e">FirmwareUpdate_GetTpmFieldUpgradeCounter</a> (_In_ <a class="el" href="struct_b_i_t_f_i_e_l_d___t_p_m___a_t_t_r_i_b_u_t_e_s.html">BITFIELD_TPM_ATTRIBUTES</a> PbfTpmAttributes, _Out_ unsigned int *PpunUpgradeCounter)</td></tr>
<tr class="memdesc:af3cb3f9cefe034224b64ad96ee2d900e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to read the field upgrade counter from the TPM.  <a href="#af3cb3f9cefe034224b64ad96ee2d900e">More...</a><br /></td></tr>
<tr class="separator:af3cb3f9cefe034224b64ad96ee2d900e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade430c7fac5a8d233db575c4c74c3f28"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#ade430c7fac5a8d233db575c4c74c3f28">FirmwareUpdate_GetTpmFirmwareVersionString</a> (_In_ <a class="el" href="struct_b_i_t_f_i_e_l_d___t_p_m___a_t_t_r_i_b_u_t_e_s.html">BITFIELD_TPM_ATTRIBUTES</a> PbfTpmAttributes, _Out_bytecap_(*PpunFirmwareVersionSize) wchar_t *PwszFirmwareVersion, _Inout_ unsigned int *PpunFirmwareVersionSize, _Out_bytecap_(*PpunFirmwareVersionShortSize) wchar_t *PwszFirmwareVersionShort, _Inout_ unsigned int *PpunFirmwareVersionShortSize)</td></tr>
<tr class="memdesc:ade430c7fac5a8d233db575c4c74c3f28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to read the firmware version string from the TPM.  <a href="#ade430c7fac5a8d233db575c4c74c3f28">More...</a><br /></td></tr>
<tr class="separator:ade430c7fac5a8d233db575c4c74c3f28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab200a40596b7d9d10b07a10e38df358d"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#ab200a40596b7d9d10b07a10e38df358d">FirmwareUpdate_IsFirmwareUpdatable</a> (_In_ <a class="el" href="struct_b_i_t_f_i_e_l_d___t_p_m___a_t_t_r_i_b_u_t_e_s.html">BITFIELD_TPM_ATTRIBUTES</a> PbfTpmAttributes, _In_bytecount_(PnFirmwareImageSize) <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> *PrgbFirmwareImage, _In_ int PnFirmwareImageSize, _In_ <a class="el" href="struct_ifx_firmware_image.html">IfxFirmwareImage</a> *PpsFirmwareImage, _Out_ <a class="el" href="_globals_8h.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> *PpfValid, _Out_ <a class="el" href="struct_b_i_t_f_i_e_l_d___n_e_w___t_p_m___f_i_r_m_w_a_r_e___i_n_f_o.html">BITFIELD_NEW_TPM_FIRMWARE_INFO</a> *PpbfNewTpmFirmwareInfo, _Out_ <a class="el" href="_t_p_m2___types_8h.html#adfe04a44baaebba6143c3a23507ff85b">UINT32</a> *PpunErrorDetails)</td></tr>
<tr class="memdesc:ab200a40596b7d9d10b07a10e38df358d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to check if the TPM is updatable with the given firmware image.  <a href="#ab200a40596b7d9d10b07a10e38df358d">More...</a><br /></td></tr>
<tr class="separator:ab200a40596b7d9d10b07a10e38df358d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc9e7d43339114afb55ea9039cb1d37b"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#adc9e7d43339114afb55ea9039cb1d37b">FirmwareUpdate_PrepareTPM20Policy</a> (_Out_ <a class="el" href="_t_p_m2___types_8h.html#adf8cd61604388f70af0ed90b7ed93c08">TPMI_SH_AUTH_SESSION</a> *PphPolicySession)</td></tr>
<tr class="memdesc:adc9e7d43339114afb55ea9039cb1d37b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepares a policy session for TPM firmware.  <a href="#adc9e7d43339114afb55ea9039cb1d37b">More...</a><br /></td></tr>
<tr class="separator:adc9e7d43339114afb55ea9039cb1d37b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2dda1c4ad87d76aa1b270c6686f9605"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#ad2dda1c4ad87d76aa1b270c6686f9605">FirmwareUpdate_Start</a> (_In_ <a class="el" href="struct_b_i_t_f_i_e_l_d___t_p_m___a_t_t_r_i_b_u_t_e_s.html">BITFIELD_TPM_ATTRIBUTES</a> PbfTpmAttributes, _In_ const <a class="el" href="struct_ifx_firmware_image.html">IfxFirmwareImage</a> *const PpsIfxFirmwareImage, _In_ const <a class="el" href="struct_ifx_firmware_update_data.html">IfxFirmwareUpdateData</a> *const PpsFirmwareUpdateData)</td></tr>
<tr class="memdesc:ad2dda1c4ad87d76aa1b270c6686f9605"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to issue TPM_FieldUpgrade_Start.  <a href="#ad2dda1c4ad87d76aa1b270c6686f9605">More...</a><br /></td></tr>
<tr class="separator:ad2dda1c4ad87d76aa1b270c6686f9605"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace5d8a33a452324993b70878ab61259b"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#ace5d8a33a452324993b70878ab61259b">FirmwareUpdate_Start_Tpm12</a> (_In_ <a class="el" href="struct_b_i_t_f_i_e_l_d___t_p_m___a_t_t_r_i_b_u_t_e_s.html">BITFIELD_TPM_ATTRIBUTES</a> PbfTpmAttributes, _In_bytecount_(PusPolicyParameterBlockSize) <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> *PrgbPolicyParameterBlock, _In_ <a class="el" href="_t_p_m2___types_8h.html#acbc04026a2008f7c2fccf01718291c20">UINT16</a> PusPolicyParameterBlockSize, _In_bytecount_(<a class="el" href="_t_p_m2___types_8h.html#a3ba9296b223f1b3c710d6b812fd860e8">SHA1_DIGEST_SIZE</a>) const <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> PrgbOwnerAuthHash[<a class="el" href="_t_p_m2___types_8h.html#a3ba9296b223f1b3c710d6b812fd860e8">SHA1_DIGEST_SIZE</a>], _In_ <a class="el" href="_firmware_update_8h.html#abc0806f5fb50bb895b973508020604df">PFN_FIRMWAREUPDATE_PROGRESSCALLBACK</a> PfnProgress)</td></tr>
<tr class="memdesc:ace5d8a33a452324993b70878ab61259b"><td class="mdescLeft">&#160;</td><td class="mdescRight">FirmwareUpdate start for TPM1.2.  <a href="#ace5d8a33a452324993b70878ab61259b">More...</a><br /></td></tr>
<tr class="separator:ace5d8a33a452324993b70878ab61259b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6615a19d550827bb435a70848b2541c9"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#a6615a19d550827bb435a70848b2541c9">FirmwareUpdate_Start_Tpm20</a> (_In_bytecount_(PusPolicyParameterBlockSize) <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> *PrgbPolicyParameterBlock, _In_ <a class="el" href="_t_p_m2___types_8h.html#acbc04026a2008f7c2fccf01718291c20">UINT16</a> PusPolicyParameterBlockSize, _In_ unsigned int PunSessionHandle, _In_ <a class="el" href="_firmware_update_8h.html#abc0806f5fb50bb895b973508020604df">PFN_FIRMWAREUPDATE_PROGRESSCALLBACK</a> PfnProgress)</td></tr>
<tr class="memdesc:a6615a19d550827bb435a70848b2541c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">FirmwareUpdate start for TPM2.0.  <a href="#a6615a19d550827bb435a70848b2541c9">More...</a><br /></td></tr>
<tr class="separator:a6615a19d550827bb435a70848b2541c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e338f325d1e2804bb3836febd1c8293"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#a1e338f325d1e2804bb3836febd1c8293">FirmwareUpdate_Tpm20_GetSecurityModuleLogicInfo2</a> (_Out_ <a class="el" href="structs_security_module_logic_info2__d.html">sSecurityModuleLogicInfo2_d</a> *PpSecurityModuleLogicInfo2)</td></tr>
<tr class="memdesc:a1e338f325d1e2804bb3836febd1c8293"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to read Security Module Logic Info from TPM2.0.  <a href="#a1e338f325d1e2804bb3836febd1c8293">More...</a><br /></td></tr>
<tr class="separator:a1e338f325d1e2804bb3836febd1c8293"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe6e0f857ea53ef8a832c2c1fb02a911"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#afe6e0f857ea53ef8a832c2c1fb02a911">FirmwareUpdate_Update</a> (_In_ <a class="el" href="_t_p_m2___types_8h.html#adfe04a44baaebba6143c3a23507ff85b">UINT32</a> PunFirmwareBlockSize, _In_bytecount_(PunFirmwareBlockSize) <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> *PrgbFirmwareBlock, _In_ <a class="el" href="_firmware_update_8h.html#abc0806f5fb50bb895b973508020604df">PFN_FIRMWAREUPDATE_PROGRESSCALLBACK</a> PfnProgress)</td></tr>
<tr class="memdesc:afe6e0f857ea53ef8a832c2c1fb02a911"><td class="mdescLeft">&#160;</td><td class="mdescRight">FirmwareUpdateProcess Update.  <a href="#afe6e0f857ea53ef8a832c2c1fb02a911">More...</a><br /></td></tr>
<tr class="separator:afe6e0f857ea53ef8a832c2c1fb02a911"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f87119fc895142e76ab98e1ddcfdbaf"><td class="memItemLeft" align="right" valign="top">_Check_return_ unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_firmware_update_8c.html#a0f87119fc895142e76ab98e1ddcfdbaf">FirmwareUpdate_UpdateImage</a> (_In_ const <a class="el" href="struct_ifx_firmware_update_data.html">IfxFirmwareUpdateData</a> *const PpsFirmwareUpdateData)</td></tr>
<tr class="memdesc:a0f87119fc895142e76ab98e1ddcfdbaf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to update the firmware with the given firmware image.  <a href="#a0f87119fc895142e76ab98e1ddcfdbaf">More...</a><br /></td></tr>
<tr class="separator:a0f87119fc895142e76ab98e1ddcfdbaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements common firmware update functionality used by different tools. </p>
<p>Implements an internal firmware update interface used by IFXTPMUpdate and TPMFactoryUpd.</p>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright 2014 - 2017 Infineon Technologies AG ( www.infineon.com )</dd>
<dd>
All rights reserved.</dd></dl>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p><ol type="1">
<li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
<li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
<li>Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission. THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </li>
</ol>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a83060c57ec90e738b71452e69b861eef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83060c57ec90e738b71452e69b861eef">&#9670;&nbsp;</a></span>TPM_FU_COMPLETE_WAIT_TIME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TPM_FU_COMPLETE_WAIT_TIME&#160;&#160;&#160;2000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Default wait time in milliseconds after sending TPM_FieldUpgrade_Complete before continuing to give TPM time to finish. </p>

</div>
</div>
<a id="afe09c8981014e666d7bb530bc2860612"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe09c8981014e666d7bb530bc2860612">&#9670;&nbsp;</a></span>TPM_FU_START_MAX_RETRIES</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TPM_FU_START_MAX_RETRIES&#160;&#160;&#160;16U</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximum amount of times to check if TPM switched to boot loader mode after TPM_FieldUpgrade_Start command. </p>

</div>
</div>
<a id="a060fa8ca52096abe6ac1351db2719709"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a060fa8ca52096abe6ac1351db2719709">&#9670;&nbsp;</a></span>TPM_FU_START_RETRY_WAIT_TIME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TPM_FU_START_RETRY_WAIT_TIME&#160;&#160;&#160;1000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Default wait time in milliseconds in between two of the above checks. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a0377c76556033d78a1b3b1af60b6692a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0377c76556033d78a1b3b1af60b6692a">&#9670;&nbsp;</a></span>FirmwareUpdate_CalculateState()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_CalculateState </td>
          <td>(</td>
          <td class="paramtype">_Out_ <a class="el" href="struct_t_p_m___s_t_a_t_e.html">TPM_STATE</a> *&#160;</td>
          <td class="paramname"><em>PpsTpmState</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the TPM state attributes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PpsTpmState</td><td>Pointer to a variable representing the TPM state</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_BAD_PARAMETER</td><td>An invalid parameter was passed to the function. PpsTpmState is NULL. </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>An unexpected error occurred. E.g. more than one property returned from TPM2_GetCapability call </td></tr>
    <tr><td class="paramname">...</td><td>Error codes from called functions. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a845ea7abd1bced9eb1c358bc2e954d8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a845ea7abd1bced9eb1c358bc2e954d8e">&#9670;&nbsp;</a></span>FirmwareUpdate_CheckImage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_CheckImage </td>
          <td>(</td>
          <td class="paramtype">_In_bytecount_(PullImageSize) <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> *&#160;</td>
          <td class="paramname"><em>PrgbImage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ <a class="el" href="_t_p_m2___types_8h.html#a95df6cdb32afc350ff070f2fe8a54a67">UINT64</a>&#160;</td>
          <td class="paramname"><em>PullImageSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Out_ <a class="el" href="_globals_8h.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> *&#160;</td>
          <td class="paramname"><em>PpfValid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Out_ <a class="el" href="struct_b_i_t_f_i_e_l_d___n_e_w___t_p_m___f_i_r_m_w_a_r_e___i_n_f_o.html">BITFIELD_NEW_TPM_FIRMWARE_INFO</a> *&#160;</td>
          <td class="paramname"><em>PpbfNewTpmFirmwareInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Out_ <a class="el" href="_t_p_m2___types_8h.html#adfe04a44baaebba6143c3a23507ff85b">UINT32</a> *&#160;</td>
          <td class="paramname"><em>PpunErrorDetails</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the firmware image is valid for the TPM. </p>
<p>Performs integrity, consistency and content checks to determine if the given firmware image can be applied to the installed TPM.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PrgbImage</td><td>Firmware image byte stream </td></tr>
    <tr><td class="paramname">PullImageSize</td><td>Size of firmware image byte stream </td></tr>
    <tr><td class="paramname">PpfValid</td><td>TRUE in case the image is valid, FALSE otherwise. </td></tr>
    <tr><td class="paramname">PpbfNewTpmFirmwareInfo</td><td>Pointer to a bit field to return info data for the new firmware image. </td></tr>
    <tr><td class="paramname">PpunErrorDetails</td><td>Pointer to an unsigned int to return error details. Possible values are:<br />
 RC_E_FW_UPDATE_BLOCKED in case the field upgrade counter value has been exceeded.<br />
 RC_E_WRONG_FW_IMAGE in case the TPM is not updatable with the given image.<br />
 RC_E_CORRUPT_FW_IMAGE in case the firmware image is corrupt.<br />
 RC_E_NEWER_TOOL_REQUIRED in case a newer version of the tool is required to parse the firmware image.<br />
 RC_E_WRONG_DECRYPT_KEYS in case the TPM2.0 does not have decrypt keys matching to the firmware image.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully </td></tr>
    <tr><td class="paramname">RC_E_BAD_PARAMETER</td><td>An invalid parameter was passed to the function. </td></tr>
    <tr><td class="paramname">RC_E_TPM20_FAILURE_MODE</td><td>The TPM2.0 is in failure mode. </td></tr>
    <tr><td class="paramname">RC_E_RESTART_REQUIRED</td><td>In case a restart is required to get back to a functional TPM </td></tr>
    <tr><td class="paramname">RC_E_NO_IFX_TPM</td><td>In case TPM vendor is not IFX </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>An unexpected error occurred. </td></tr>
    <tr><td class="paramname">...</td><td>Error codes from called functions. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab87fa675eeff94b93fe70af6949ff7c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab87fa675eeff94b93fe70af6949ff7c2">&#9670;&nbsp;</a></span>FirmwareUpdate_CheckOwnerAuthorization()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_CheckOwnerAuthorization </td>
          <td>(</td>
          <td class="paramtype">_In_bytecount_(<a class="el" href="_t_p_m2___types_8h.html#a3ba9296b223f1b3c710d6b812fd860e8">SHA1_DIGEST_SIZE</a>) const <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>&#160;</td>
          <td class="paramname"><em>PrgbOwnerAuthHash</em>[SHA1_DIGEST_SIZE]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks TPM Owner authorization on TPM1.2. </p>
<p>The function checks TPM Owner authorization on TPM1.2 by calling TPM_ChangeAuthOwner with old and new TPM Owner authorization value set to the same value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PrgbOwnerAuthHash</td><td>TPM Owner Authentication hash (sha1)</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>An internal error occurred. </td></tr>
    <tr><td class="paramname">...</td><td>Error codes from called functions. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a5922ef9aed2a0504451573ec997ec076"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5922ef9aed2a0504451573ec997ec076">&#9670;&nbsp;</a></span>FirmwareUpdate_Complete()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_Complete </td>
          <td>(</td>
          <td class="paramtype">_In_ <a class="el" href="_firmware_update_8h.html#abc0806f5fb50bb895b973508020604df">PFN_FIRMWAREUPDATE_PROGRESSCALLBACK</a>&#160;</td>
          <td class="paramname"><em>PfnProgress</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FirmwareUpdate Complete. </p>
<p>The function finishes the firmware update process.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PfnProgress</td><td>Callback function to indicate the progress </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>In case of a TPM connection or command error </td></tr>
    <tr><td class="paramname">RC_E_FIRMWARE_UPDATE_FAILED</td><td>The update operation was started but failed </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a57734866cfa76a17da2cd78309267e00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57734866cfa76a17da2cd78309267e00">&#9670;&nbsp;</a></span>FirmwareUpdate_GetImageInfo()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_GetImageInfo </td>
          <td>(</td>
          <td class="paramtype">_Inout_bytecap_ *PpunVersionNameSize wchar_t *&#160;</td>
          <td class="paramname"><em>PwszVersionName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Inout_ unsigned int *&#160;</td>
          <td class="paramname"><em>PpunVersionNameSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Inout_ <a class="el" href="struct_t_p_m___s_t_a_t_e.html">TPM_STATE</a> *&#160;</td>
          <td class="paramname"><em>PpsTpmState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Inout_ unsigned int *&#160;</td>
          <td class="paramname"><em>PpunRemainingUpdates</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns information about the current state of TPM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PwszVersionName</td><td>A pointer to a null-terminated string representing the firmware image version name. </td></tr>
    <tr><td class="paramname">PpunVersionNameSize</td><td>IN: Capacity of the PwszVersionName parameter in wide characters including zero termination OUT: Length of written wide character string (excluding zero termination) </td></tr>
    <tr><td class="paramname">PpsTpmState</td><td>Receives TPM state. </td></tr>
    <tr><td class="paramname">PpunRemainingUpdates</td><td>Receives the number of remaining updates or -1 in case the value could not be detected.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>An unexpected error occurred. </td></tr>
    <tr><td class="paramname">RC_E_BAD_PARAMETER</td><td>An invalid parameter was passed to the function. </td></tr>
    <tr><td class="paramname">RC_E_NO_IFX_TPM</td><td>The TPM is not manufactured by Infineon. </td></tr>
    <tr><td class="paramname">...</td><td>Error codes from called functions. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af3cb3f9cefe034224b64ad96ee2d900e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3cb3f9cefe034224b64ad96ee2d900e">&#9670;&nbsp;</a></span>FirmwareUpdate_GetTpmFieldUpgradeCounter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_GetTpmFieldUpgradeCounter </td>
          <td>(</td>
          <td class="paramtype">_In_ <a class="el" href="struct_b_i_t_f_i_e_l_d___t_p_m___a_t_t_r_i_b_u_t_e_s.html">BITFIELD_TPM_ATTRIBUTES</a>&#160;</td>
          <td class="paramname"><em>PbfTpmAttributes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Out_ unsigned int *&#160;</td>
          <td class="paramname"><em>PpunUpgradeCounter</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to read the field upgrade counter from the TPM. </p>
<p>This function obtains the field upgrade counter value from the TPM.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PbfTpmAttributes</td><td>TPM state attributes </td></tr>
    <tr><td class="paramname">PpunUpgradeCounter</td><td>Pointer to the field upgrade counter parameter</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_BAD_PARAMETER</td><td>An invalid parameter was passed to the function. The parameter is NULL </td></tr>
    <tr><td class="paramname">RC_E_UNSUPPORTED_CHIP</td><td>In case of the underlying TPM does not support FieldUpdateCounter acquiring commands </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>An unexpected error occurred. </td></tr>
    <tr><td class="paramname">...</td><td>Error codes from called functions. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ade430c7fac5a8d233db575c4c74c3f28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade430c7fac5a8d233db575c4c74c3f28">&#9670;&nbsp;</a></span>FirmwareUpdate_GetTpmFirmwareVersionString()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_GetTpmFirmwareVersionString </td>
          <td>(</td>
          <td class="paramtype">_In_ <a class="el" href="struct_b_i_t_f_i_e_l_d___t_p_m___a_t_t_r_i_b_u_t_e_s.html">BITFIELD_TPM_ATTRIBUTES</a>&#160;</td>
          <td class="paramname"><em>PbfTpmAttributes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Out_bytecap_ *PpunFirmwareVersionSize wchar_t *&#160;</td>
          <td class="paramname"><em>PwszFirmwareVersion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Inout_ unsigned int *&#160;</td>
          <td class="paramname"><em>PpunFirmwareVersionSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Out_bytecap_ *PpunFirmwareVersionShortSize wchar_t *&#160;</td>
          <td class="paramname"><em>PwszFirmwareVersionShort</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Inout_ unsigned int *&#160;</td>
          <td class="paramname"><em>PpunFirmwareVersionShortSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to read the firmware version string from the TPM. </p>
<p>This function obtains the firmware version string from the TPM.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PbfTpmAttributes</td><td>TPM state attributes </td></tr>
    <tr><td class="paramname">PwszFirmwareVersion</td><td>Wide character string output buffer for the firmware version (must be allocated by the caller) </td></tr>
    <tr><td class="paramname">PpunFirmwareVersionSize</td><td>In: Capacity of the wide character string including the zero termination Out: String length without the zero termination </td></tr>
    <tr><td class="paramname">PwszFirmwareVersionShort</td><td>Wide character string output buffer for the firmware version without subversion.minor (must be allocated by the caller) </td></tr>
    <tr><td class="paramname">PpunFirmwareVersionShortSize</td><td>In: Capacity of the wide character string including the zero termination Out: String length without the zero termination</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_BAD_PARAMETER</td><td>An invalid parameter was passed to the function. The parameter is NULL or the output buffer is too small </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>An unexpected error occurred. E.g. more than one property returned from TPM2_GetCapability call or unknown <a class="el" href="struct_b_i_t_f_i_e_l_d___t_p_m___a_t_t_r_i_b_u_t_e_s.html" title="TPM state attributes used in FirmwareUpdate interface methods. ">BITFIELD_TPM_ATTRIBUTES</a> </td></tr>
    <tr><td class="paramname">...</td><td>Error codes from called functions. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ab200a40596b7d9d10b07a10e38df358d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab200a40596b7d9d10b07a10e38df358d">&#9670;&nbsp;</a></span>FirmwareUpdate_IsFirmwareUpdatable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_IsFirmwareUpdatable </td>
          <td>(</td>
          <td class="paramtype">_In_ <a class="el" href="struct_b_i_t_f_i_e_l_d___t_p_m___a_t_t_r_i_b_u_t_e_s.html">BITFIELD_TPM_ATTRIBUTES</a>&#160;</td>
          <td class="paramname"><em>PbfTpmAttributes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_bytecount_(PnFirmwareImageSize) <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> *&#160;</td>
          <td class="paramname"><em>PrgbFirmwareImage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ int&#160;</td>
          <td class="paramname"><em>PnFirmwareImageSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ <a class="el" href="struct_ifx_firmware_image.html">IfxFirmwareImage</a> *&#160;</td>
          <td class="paramname"><em>PpsFirmwareImage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Out_ <a class="el" href="_globals_8h.html#a050c65e107f0c828f856a231f4b4e788">BOOL</a> *&#160;</td>
          <td class="paramname"><em>PpfValid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Out_ <a class="el" href="struct_b_i_t_f_i_e_l_d___n_e_w___t_p_m___f_i_r_m_w_a_r_e___i_n_f_o.html">BITFIELD_NEW_TPM_FIRMWARE_INFO</a> *&#160;</td>
          <td class="paramname"><em>PpbfNewTpmFirmwareInfo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_Out_ <a class="el" href="_t_p_m2___types_8h.html#adfe04a44baaebba6143c3a23507ff85b">UINT32</a> *&#160;</td>
          <td class="paramname"><em>PpunErrorDetails</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to check if the TPM is updatable with the given firmware image. </p>
<p>Some parameters like GUID, file content signature, TPM firmware major minor version or file content CRC are checked to get a decision if the firmware is updatable with the current image.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PbfTpmAttributes</td><td>TPM state attributes </td></tr>
    <tr><td class="paramname">PrgbFirmwareImage</td><td>Pointer to the firmware image byte stream </td></tr>
    <tr><td class="paramname">PnFirmwareImageSize</td><td>Size of the firmware image byte stream </td></tr>
    <tr><td class="paramname">PpsFirmwareImage</td><td>Pointer to the unmarshalled firmware image structure (Unmarshalled PrgbFirmwareImage) </td></tr>
    <tr><td class="paramname">PpfValid</td><td>TRUE in case the image is valid, FALSE otherwise. </td></tr>
    <tr><td class="paramname">PpbfNewTpmFirmwareInfo</td><td>Pointer to a bit field to return info data for the new firmware image. </td></tr>
    <tr><td class="paramname">PpunErrorDetails</td><td>Pointer to an unsigned int to return error details. Possible values are:<br />
 RC_E_FW_UPDATE_BLOCKED in case the field upgrade counter value has been exceeded.<br />
 RC_E_WRONG_FW_IMAGE in case the TPM is not updatable with the given image.<br />
 RC_E_CORRUPT_FW_IMAGE in case the firmware image is corrupt.<br />
 RC_E_NEWER_TOOL_REQUIRED in case a newer version of the tool is required to parse the firmware image.<br />
 RC_E_WRONG_DECRYPT_KEYS in case the TPM2.0 does not have decrypt keys matching to the firmware image.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>An unexpected error occurred. </td></tr>
    <tr><td class="paramname">RC_E_BAD_PARAMETER</td><td>In case of a NULL input parameter </td></tr>
    <tr><td class="paramname">...</td><td>Error codes from called functions. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="adc9e7d43339114afb55ea9039cb1d37b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc9e7d43339114afb55ea9039cb1d37b">&#9670;&nbsp;</a></span>FirmwareUpdate_PrepareTPM20Policy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_PrepareTPM20Policy </td>
          <td>(</td>
          <td class="paramtype">_Out_ <a class="el" href="_t_p_m2___types_8h.html#adf8cd61604388f70af0ed90b7ed93c08">TPMI_SH_AUTH_SESSION</a> *&#160;</td>
          <td class="paramname"><em>PphPolicySession</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepares a policy session for TPM firmware. </p>
<p>The function prepares a policy session for TPM Firmware Update.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PphPolicySession</td><td>Pointer to session handle that will be filled in by this method.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_BAD_PARAMETER</td><td>An invalid parameter was passed to the function. It is invalid or NULL. </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>An unexpected error occurred. </td></tr>
    <tr><td class="paramname">RC_E_PLATFORM_AUTH_NOT_EMPTY</td><td>In case PlatformAuth is not the Empty Buffer. </td></tr>
    <tr><td class="paramname">RC_E_PLATFORM_HIERARCHY_DISABLED</td><td>In case platform hierarchy has been disabled. </td></tr>
    <tr><td class="paramname">...</td><td>Error codes from called functions. like TPM error codes </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad2dda1c4ad87d76aa1b270c6686f9605"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2dda1c4ad87d76aa1b270c6686f9605">&#9670;&nbsp;</a></span>FirmwareUpdate_Start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_Start </td>
          <td>(</td>
          <td class="paramtype">_In_ <a class="el" href="struct_b_i_t_f_i_e_l_d___t_p_m___a_t_t_r_i_b_u_t_e_s.html">BITFIELD_TPM_ATTRIBUTES</a>&#160;</td>
          <td class="paramname"><em>PbfTpmAttributes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ const <a class="el" href="struct_ifx_firmware_image.html">IfxFirmwareImage</a> *const&#160;</td>
          <td class="paramname"><em>PpsIfxFirmwareImage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ const <a class="el" href="struct_ifx_firmware_update_data.html">IfxFirmwareUpdateData</a> *const&#160;</td>
          <td class="paramname"><em>PpsFirmwareUpdateData</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to issue TPM_FieldUpgrade_Start. </p>
<p>This function initiates TPM Firmware Update via the TPM_FieldUpgrade_Start command depending on the current TPM Operation mode.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PbfTpmAttributes</td><td>The current TPM operation mode </td></tr>
    <tr><td class="paramname">PpsIfxFirmwareImage</td><td>Pointer to structure containing the firmware image </td></tr>
    <tr><td class="paramname">PpsFirmwareUpdateData</td><td>Pointer to structure containing all relevant data for a firmware update</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_TPM12_MISSING_OWNERAUTH</td><td>The TPM has an owner but TPM Owner authorization was not provided (TPM1.2 only). </td></tr>
    <tr><td class="paramname">RC_E_TPM12_NO_OWNER</td><td>The TPM does not have an owner but TPM Owner authorization was provided (TPM1.2 only). </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>TPM connection or command error. </td></tr>
    <tr><td class="paramname">...</td><td>Error codes from called functions. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ace5d8a33a452324993b70878ab61259b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace5d8a33a452324993b70878ab61259b">&#9670;&nbsp;</a></span>FirmwareUpdate_Start_Tpm12()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_Start_Tpm12 </td>
          <td>(</td>
          <td class="paramtype">_In_ <a class="el" href="struct_b_i_t_f_i_e_l_d___t_p_m___a_t_t_r_i_b_u_t_e_s.html">BITFIELD_TPM_ATTRIBUTES</a>&#160;</td>
          <td class="paramname"><em>PbfTpmAttributes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_bytecount_(PusPolicyParameterBlockSize) <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> *&#160;</td>
          <td class="paramname"><em>PrgbPolicyParameterBlock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ <a class="el" href="_t_p_m2___types_8h.html#acbc04026a2008f7c2fccf01718291c20">UINT16</a>&#160;</td>
          <td class="paramname"><em>PusPolicyParameterBlockSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_bytecount_(<a class="el" href="_t_p_m2___types_8h.html#a3ba9296b223f1b3c710d6b812fd860e8">SHA1_DIGEST_SIZE</a>) const <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a>&#160;</td>
          <td class="paramname"><em>PrgbOwnerAuthHash</em>[SHA1_DIGEST_SIZE], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ <a class="el" href="_firmware_update_8h.html#abc0806f5fb50bb895b973508020604df">PFN_FIRMWAREUPDATE_PROGRESSCALLBACK</a>&#160;</td>
          <td class="paramname"><em>PfnProgress</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FirmwareUpdate start for TPM1.2. </p>
<p>The function takes the firmware update policy parameter block and starts the firmware update process.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PbfTpmAttributes</td><td>The operation mode of the TPM. </td></tr>
    <tr><td class="paramname">PrgbPolicyParameterBlock</td><td>Pointer to the policy parameter block byte stream </td></tr>
    <tr><td class="paramname">PusPolicyParameterBlockSize</td><td>Size of the policy parameter block </td></tr>
    <tr><td class="paramname">PrgbOwnerAuthHash</td><td>TPM Owner authentication hash (sha1) </td></tr>
    <tr><td class="paramname">PfnProgress</td><td>Callback function to indicate the progress</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_BAD_PARAMETER</td><td>An invalid parameter was passed to the function. Policy parameter block stream is NULL or policy session handle is not 0. </td></tr>
    <tr><td class="paramname">RC_E_CORRUPT_FW_IMAGE</td><td>Policy parameter block is corrupt and/or cannot be unmarshalled. </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>TPM connection or command error. </td></tr>
    <tr><td class="paramname">RC_E_TPM12_DEFERREDPP_REQUIRED</td><td>Deferred Physical Presence has not been set (TPM1.2 only). </td></tr>
    <tr><td class="paramname">RC_E_FIRMWARE_UPDATE_FAILED</td><td>The update operation was started but failed. </td></tr>
    <tr><td class="paramname">RC_E_TPM12_INVALID_OWNERAUTH</td><td>TPM Owner authentication is incorrect (TPM1.2 only). </td></tr>
    <tr><td class="paramname">RC_E_TPM12_DA_ACTIVE</td><td>The TPM Owner is locked out due to dictionary attack (TPM1.2 only). </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6615a19d550827bb435a70848b2541c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6615a19d550827bb435a70848b2541c9">&#9670;&nbsp;</a></span>FirmwareUpdate_Start_Tpm20()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_Start_Tpm20 </td>
          <td>(</td>
          <td class="paramtype">_In_bytecount_(PusPolicyParameterBlockSize) <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> *&#160;</td>
          <td class="paramname"><em>PrgbPolicyParameterBlock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ <a class="el" href="_t_p_m2___types_8h.html#acbc04026a2008f7c2fccf01718291c20">UINT16</a>&#160;</td>
          <td class="paramname"><em>PusPolicyParameterBlockSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ unsigned int&#160;</td>
          <td class="paramname"><em>PunSessionHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ <a class="el" href="_firmware_update_8h.html#abc0806f5fb50bb895b973508020604df">PFN_FIRMWAREUPDATE_PROGRESSCALLBACK</a>&#160;</td>
          <td class="paramname"><em>PfnProgress</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FirmwareUpdate start for TPM2.0. </p>
<p>The function takes the firmware update policy parameter block and the stored policy session and starts the firmware update process.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PusPolicyParameterBlockSize</td><td>Size of the policy parameter block </td></tr>
    <tr><td class="paramname">PrgbPolicyParameterBlock</td><td>Pointer to the policy parameter block byte stream </td></tr>
    <tr><td class="paramname">PunSessionHandle</td><td>Session handle </td></tr>
    <tr><td class="paramname">PfnProgress</td><td>Callback function to indicate the progress</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_BAD_PARAMETER</td><td>An invalid parameter was passed to the function. Policy parameter block stream is NULL </td></tr>
    <tr><td class="paramname">RC_E_TPM20_INVALID_POLICY_SESSION</td><td>The policy session handle is 0 or invalid or policy authorization failed </td></tr>
    <tr><td class="paramname">RC_E_TPM20_POLICY_HANDLE_OUT_OF_RANGE</td><td>The policy handle value is out of range </td></tr>
    <tr><td class="paramname">RC_E_TPM20_POLICY_SESSION_NOT_LOADED</td><td>The policy session is not loaded to the TPM </td></tr>
    <tr><td class="paramname">RC_E_CORRUPT_FW_IMAGE</td><td>Firmware image is corrupt </td></tr>
    <tr><td class="paramname">RC_E_FIRMWARE_UPDATE_FAILED</td><td>Firmware update started but failed </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>An unexpected error occurred. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1e338f325d1e2804bb3836febd1c8293"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e338f325d1e2804bb3836febd1c8293">&#9670;&nbsp;</a></span>FirmwareUpdate_Tpm20_GetSecurityModuleLogicInfo2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_Tpm20_GetSecurityModuleLogicInfo2 </td>
          <td>(</td>
          <td class="paramtype">_Out_ <a class="el" href="structs_security_module_logic_info2__d.html">sSecurityModuleLogicInfo2_d</a> *&#160;</td>
          <td class="paramname"><em>PpSecurityModuleLogicInfo2</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to read Security Module Logic Info from TPM2.0. </p>
<p>This function obtains the Security Module Logic Info from TPM2.0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PpSecurityModuleLogicInfo2</td><td>Pointer to the Security Module Logic Info</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_BAD_PARAMETER</td><td>An invalid parameter was passed to the function. The parameter is NULL </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>An unexpected error occurred. </td></tr>
    <tr><td class="paramname">...</td><td>Error codes from called functions. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="afe6e0f857ea53ef8a832c2c1fb02a911"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe6e0f857ea53ef8a832c2c1fb02a911">&#9670;&nbsp;</a></span>FirmwareUpdate_Update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_Update </td>
          <td>(</td>
          <td class="paramtype">_In_ <a class="el" href="_t_p_m2___types_8h.html#adfe04a44baaebba6143c3a23507ff85b">UINT32</a>&#160;</td>
          <td class="paramname"><em>PunFirmwareBlockSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_bytecount_(PunFirmwareBlockSize) <a class="el" href="_globals_8h.html#a4ae1dab0fb4b072a66584546209e7d58">BYTE</a> *&#160;</td>
          <td class="paramname"><em>PrgbFirmwareBlock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">_In_ <a class="el" href="_firmware_update_8h.html#abc0806f5fb50bb895b973508020604df">PFN_FIRMWAREUPDATE_PROGRESSCALLBACK</a>&#160;</td>
          <td class="paramname"><em>PfnProgress</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FirmwareUpdateProcess Update. </p>
<p>The function determines the maximum data size for a firmware block and sends the firmware to the TPM in chunks of maximum data size.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PunFirmwareBlockSize</td><td>Size of the firmware block </td></tr>
    <tr><td class="paramname">PrgbFirmwareBlock</td><td>Pointer to the firmware block byte stream </td></tr>
    <tr><td class="paramname">PfnProgress</td><td>Callback function to indicate the progress</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_BAD_PARAMETER</td><td>An invalid parameter was passed to the function. The firmware image block is NULL </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>In case of a TPM connection or command error </td></tr>
    <tr><td class="paramname">RC_E_FIRMWARE_UPDATE_FAILED</td><td>The update operation was started but failed </td></tr>
    <tr><td class="paramname">RC_E_TPM_NO_BOOT_LOADER_MODE</td><td>The TPM is not in boot loader mode </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0f87119fc895142e76ab98e1ddcfdbaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f87119fc895142e76ab98e1ddcfdbaf">&#9670;&nbsp;</a></span>FirmwareUpdate_UpdateImage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_Check_return_ unsigned int FirmwareUpdate_UpdateImage </td>
          <td>(</td>
          <td class="paramtype">_In_ const <a class="el" href="struct_ifx_firmware_update_data.html">IfxFirmwareUpdateData</a> *const&#160;</td>
          <td class="paramname"><em>PpsFirmwareUpdateData</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to update the firmware with the given firmware image. </p>
<p>This function updates the TPM firmware with the image given in the parameters. A check if the firmware can be updated with the image is done before.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PpsFirmwareUpdateData</td><td>Pointer to structure containing all relevant data for a firmware update</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">RC_SUCCESS</td><td>The operation completed successfully. </td></tr>
    <tr><td class="paramname">RC_E_CORRUPT_FW_IMAGE</td><td>Policy parameter block is corrupt and/or cannot be unmarshalled. </td></tr>
    <tr><td class="paramname">RC_E_NO_IFX_TPM</td><td>The TPM is not manufactured by Infineon. </td></tr>
    <tr><td class="paramname">RC_E_TPM12_MISSING_OWNERAUTH</td><td>The TPM has an owner but TPM Owner authorization was not provided (TPM1.2 only). </td></tr>
    <tr><td class="paramname">RC_E_TPM12_NO_OWNER</td><td>The TPM does not have an owner but TPM Owner authorization was provided (TPM1.2 only). </td></tr>
    <tr><td class="paramname">RC_E_FAIL</td><td>TPM connection or command error. </td></tr>
    <tr><td class="paramname">...</td><td>Error codes from called functions. </td></tr>
    <tr><td class="paramname">RC_E_FIRMWARE_UPDATE_FAILED</td><td>The update operation was started but failed. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
<hr class="footer"/>
<p style="float: left; padding-left:0.2em"><font color="#E20036"><b>Restricted</b></font></p>
<p style="float: right;">Copyright  2017 Infineon Technologies AG ( www.infineon.com ). All Rights Reserved.<br>&nbsp;</p>
</body>
</html>
